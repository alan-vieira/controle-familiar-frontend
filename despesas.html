<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Controle Familiar — Despesas</title>
    <link rel="stylesheet" href="css/login.css" />
  </head>
  <body>
    <header style="display:flex;align-items:center;justify-content:space-between;padding:12px 18px;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,0.06)">
      <h2 style="margin:0">Despesas</h2>
      <div>
        <button id="btnLogout" style="padding:8px 12px;border-radius:8px;border:0;background:#ef4444;color:#fff">Sair</button>
      </div>
    </header>

    <main style="padding:16px;max-width:980px;margin:18px auto">
      <section id="content">
        <p id="statusMsg">Carregando despesas...</p>
        <table id="tbl" style="width:100%;border-collapse:collapse;display:none">
          <thead>
            <tr><th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb">Data</th><th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb">Descrição</th><th style="text-align:right;padding:8px;border-bottom:1px solid #e5e7eb">Valor</th></tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </section>
    </main>

    <script>
      window.API_BASE = 'https://controle-familiar.onrender.com/api';
    </script>
    <script src="js/app.js"></script>
    <script>
      // page logic
      document.getElementById('btnLogout').addEventListener('click', async () => {
        try {
          await fetch(window.API_BASE + '/auth/logout', { method: 'POST', credentials: 'include' });
        } catch(e){}
        // sempre redireciona para login
        window.location.href = '/';
      });

      (async function init(){
        const status = document.getElementById('statusMsg');
        try {
          // checar se está logado
          const s = await fetch(window.API_BASE + '/auth/status', { method: 'GET', credentials: 'include', headers:{'Accept':'application/json'} });
          if (!s.ok) { window.location.href = '/'; return; }
          const sj = await s.json();
          if (!sj || !sj.logged_in) { window.location.href = '/'; return; }
          // carregar despesas
          await loadDespesas();
        } catch(err){
          console.error(err);
          window.location.href = '/';
        }
      })();
    </script>
  </body>
</html>
